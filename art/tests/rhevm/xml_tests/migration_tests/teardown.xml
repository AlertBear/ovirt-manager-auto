<?xml version="1.0" encoding="UTF-8"?>
<!-- vim: set ts=3 sw=3 expandtab: -->
<?xml-stylesheet type="text/xsl" href="table.xslt"?>

<input pydocs="/home/jhenner/work/rest-api-tests/html_editor/docs.txt">
<!-- <span style="display:none" >TEST_DESCRIPTION</span>
   Tests of migration functionality.
   Including manual migration, maintained host, cluster policies, migration between clusters and negative tests
   Requirements: 2 hosts, 16 macs(vms)
-->
<test_case>
   <test_name>START_GROUP: migrations_tear-down</test_name>
   <test_action/>
   <parameters></parameters>
   <positive>NONE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Stop VM</test_name>
   <test_action>stopVm</test_action>
   <parameters>vm='Migrations_VM-#loop_index'</parameters>
   <positive>TRUE</positive>
   <run>loop(5)</run>
</test_case>
<test_case>
   <test_name>Wait for tasks to complete</test_name>
   <test_action>sleep</test_action>
   <parameters>seconds=20</parameters>
   <positive>NONE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Remove MACs from cobbler</test_name>
   <test_action>cobblerRemoveMultiSystem</test_action>
   <parameters>
	   vms='Migrations_VM-#loop_index',
	   cobblerAddress='{cobbler_address}',
	   cobblerUser='{cobbler_user}',
	   cobblerPasswd='{cobbler_passwd}'
   </parameters>
   <positive>TRUE</positive>
   <run>loop(5)</run>
</test_case>
<test_case>
   <test_name>Remove VMs</test_name>
   <test_action>removeVm</test_action>
   <parameters>vm='Migrations_VM-#loop_index'</parameters>
   <positive>TRUE</positive>
   <run>loop(5)</run>
</test_case>
<test_case>
   <test_name>Wait for VM remove tasks to complete</test_name>
   <test_action>sleep</test_action>
   <parameters>seconds=20</parameters>
   <positive>NONE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Deactivate Storage Domain</test_name>
   <test_action>deactivateStorageDomain</test_action>
   <parameters>datacenter='{datacenter1_name}', storagedomain='{storagedomain1}'</parameters>
   <positive>TRUE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Remove Data Centers</test_name>
   <test_action>removeDataCenters</test_action>
   <parameters>datacenters='{datacenter1_name}'</parameters>
   <positive>TRUE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Remove Master Storage Domain</test_name>
   <test_action>removeStorageDomain</test_action>
   <parameters>storagedomain='{storagedomain1}', host='{vds[0]}', format='true'</parameters>
   <positive>TRUE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Set Hosts To Maintenance</test_name>
   <test_action>deactivateHost</test_action>
   <parameters>host='{vds}'</parameters>
   <positive>TRUE</positive>
   <run>loop({vds})</run>
</test_case>
<test_case>
   <test_name>Remove Hosts</test_name>
   <test_action>removeHost</test_action>
   <parameters>host='{vds}'</parameters>
   <positive>TRUE</positive>
   <run>loop({vds})</run>
</test_case>
<test_case>
   <test_name>Remove Clusters</test_name>
   <test_action>removeClusters</test_action>
   <parameters>clusters='{cluster1_name}'</parameters>
   <positive>TRUE</positive>
   <run>YES</run>
</test_case>
<test_case>
   <test_name>Check no error events occured</test_name>
   <test_action>searchForRecentEvent</test_action>
   <parameters>win_start_query='{datacenter1_name} type=950', query='severity>=error', expected_count=0</parameters>
   <positive>TRUE</positive>
   <run>no</run>
</test_case>

<test_case>
   <test_name>END_GROUP: migrations_tear-down</test_name>
   <test_action/>
   <parameters/>
   <positive>NONE</positive>
   <run/>
</test_case>
</input>
